<% feed.forEach(function(feedItem) { %>
  <tr>
    <td><%= feedItem.name %></td>
    <td><%= feedItem.address %></td>
    <td>$<%= feedItem.rate %>/hr</td>
    <td><%= feedItem.email %></td>
    <td><button class="button is-danger start-booking" data-target="#modal-confirm-booking&<%= feedItem.email%>">Book</button></td>
  </tr>
  
  <div id="modal-confirm-booking&<%= feedItem.email%>" class="modal">
    <div class="modal-background"></div>
    <div class="modal-content">
      <div class="box">
        <div class="title"><%= feedItem.name %> Booking</div>
        <div class="is-size-5 has-text-weight-bold">Details</div>

            <div>Pet-sit name: <%= feedItem.name %></div>
            <div>Address: <%= feedItem.address %></div>
            <div>Hourly rate: $<%= feedItem.rate %>/hr</div>
            <div>Email: <%= feedItem.email %></div>
        <br>
        
        <div class="field">
          <label class="label">Drop off date</label>
          <div class="select">
            <select id="select-date-1&<%= feedItem.email%>">
              <% feedItem.availability.forEach(function(avail) { %>
                <option><%= avail%></option>
              <% }) %>
            </select>
          </div>
        </div>

        <div class="field">
          <label class="label">Pick up date</label>
          <div class="select">
            <select id="select-date-2&<%= feedItem.email%>">
              <% feedItem.availability.forEach(function(avail) { %>
                <option><%= avail%></option>
              <% }) %>
            </select>
          </div>
        </div>

        <div class="field is-grouped">
          <div class="control">
            <button class="button is-danger submit-bookingconf" data-target="#modal-confirm-booking&<%= feedItem.email%>">Submit</button>
          </div>
          <div class="control">
            <button class="button is-link is-light close-bookingconf" data-target="#modal-confirm-booking&<%= feedItem.email%>">Cancel</button>
          </div>
        </div>

      </div>
    </div>
    <button class="modal-close is-large close-bookingconf" data-target="#modal-confirm-booking&<%= feedItem.email%>" aria-label="close"></button>
  </div>
  
<% }) %>

<script>
let petSitterBookings = document.getElementsByClassName("start-booking");
let submitButtons = document.getElementsByClassName("submit-bookingconf");
let cancelButtons = document.getElementsByClassName("close-bookingconf");

for(let el of petSitterBookings) {
  el.addEventListener("click", openModal);
}
for(let el of submitButtons) {
  el.addEventListener("click", submitBooking);
}
for(let el of cancelButtons) {
  el.addEventListener("click", cancelBooking);
}

function openModal(event) {
  let targetId = event.target.getAttribute("data-target").slice(1);
  let modal = document.getElementById(targetId);
  modal.classList.add("is-active");
}

function submitBooking(event) {
  let email = event.target.getAttribute("data-target").split('&')[1];
  let user_email = document.getElementById("user-email")
    .textContent.split(" ")
    .filter(w => w.length > 0)[1];
  let dropOffDate = document.getElementById("select-date-1&" + email).value;
  let pickUpDate = document.getElementById("select-date-2&" + email).value;
  console.log("dropoff: " + dropOffDate);
  console.log("pickup: " + pickUpDate);
  console.log("customer: " + user_email);
  console.log("submit booking for email: " + email);
  
  closeModal(event);
}

function cancelBooking(event) {  
  closeModal(event);
}

function closeModal(event) {
  let targetId = event.target.getAttribute("data-target").slice(1);
  let modal = document.getElementById(targetId);
  modal.classList.remove("is-active");
}
    
  
</script>